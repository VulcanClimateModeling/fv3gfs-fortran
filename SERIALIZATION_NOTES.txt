# build
git clone git@github.com:VulcanClimateModeling/fv3gfs-fortran.git
cd fv3gfs-fortran
git checkout serialize_physics
./phys_build.sh

# setup venv which contains fv3config
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# create a run directory
# Note: can also use "write_run_directory config.yml rundir" instead
# Note: pick the *.yaml of your preference, but not the baroclinic ones
# Note: make sure the namelist actually does a reasonable amount of timesteps for serialization
./example/create_rundir.py
cp example/submit_job.sh rundir/

# create clean script
cat >> rundir/clean.sh
#!/bin/bash
\rm *.tile*.nc RESTART/* test_data/* *.out
[CTRL-D]
chmod 755 rundir/clean.sh

# append submit script to extract serialized data from tmpfs
cat >> rundir/submit_job.sh
mkdir -p data
mv test_data/* data/
[CTRL-D]

# choose which physics parameterization to serialize and run
export SER_ENV=NOAH_LSM
./phys_run.sh
